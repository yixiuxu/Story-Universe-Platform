# 紧急修复说明

## 🔧 已修复的问题

### 1. 图片分析功能
- ✅ 已从 GLM-4V-Plus 切换到 **GLM-4.5V**
- ✅ 使用普通密钥（600万token）
- ✅ 完全兼容，无需修改前端代码

### 2. 视频分析功能  
- ✅ 已从 GLM-4V-Plus 切换到 **GLM-4.5V**
- ✅ 使用普通密钥（600万token）
- ✅ 完全兼容，无需修改前端代码

### 3. 联网搜索功能
- ✅ 已从 GLM-4-Plus 切换到 **GLM-4-Air + web_search工具**
- ✅ 使用普通密钥（1000万token）
- ✅ 支持 search-std, search-pro, search-pro-quark, search-pro-sogou

---

## 📝 前端需要添加的功能

### 分镜助手页面需要添加：

#### 1. 批量生成分镜图片按钮
```typescript
// 在分镜生成结果下方添加
<Button onClick={handleGenerateImages}>
  生成前3个分镜图片
</Button>
```

**API调用：**
```typescript
POST /api/storyboard/generate-images
{
  "shots": [分镜1, 分镜2, 分镜3]  // 前3个分镜
}
```

#### 2. 生成视频按钮
```typescript
// 在图片生成后显示
<Button onClick={handleGenerateVideo}>
  生成视频（首尾帧）
</Button>
```

**API调用：**
```typescript
POST /api/storyboard/generate-video
{
  "images": ["图片1_URL", "图片2_URL", "图片3_URL"],
  "prompt": "展现分镜内容的流畅转换"
}
```

---

## 🎯 快速测试

### 测试图片分析
```bash
curl -X POST http://localhost:8000/api/storyboard/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "image_url": "https://example.com/test.jpg",
    "analysis_type": "composition"
  }'
```

### 测试联网搜索
```bash
curl -X POST http://localhost:8000/api/search/hot-topics \
  -H "Content-Type: application/json" \
  -d '{
    "category": "social",
    "limit": 5
  }'
```

### 测试分镜图片生成
```bash
curl -X POST http://localhost:8000/api/storyboard/generate-images \
  -H "Content-Type: application/json" \
  -d '{
    "shots": [
      {
        "shot_number": 1,
        "description": "未来城市夜景",
        "composition": "广角镜头",
        "mood": "科幻感"
      }
    ]
  }'
```

---

## ⚠️ 重要提示

1. **所有功能现在都使用普通密钥**
2. **GLM-4.5V** 支持图片和视频分析（600万token）
3. **GLM-4-Air** 支持联网搜索（1000万token）
4. **CogView-4** 和 **CogVideoX-3** 按次计费

---

## 📊 资源使用情况

| 功能 | 模型 | 密钥 | 额度 |
|------|------|------|------|
| 图片分析 | glm-4.5v | 普通 | 600万token |
| 视频分析 | glm-4.5v | 普通 | 600万token |
| 联网搜索 | glm-4-air | 普通 | 1000万token |
| 图片生成 | cogview-4 | 普通 | 按次计费 |
| 视频生成 | cogvideox-3 | 普通 | 按次计费 |

---

## 🚀 下一步

前端开发需要在分镜助手页面添加：
1. "生成分镜图片"按钮
2. 图片展示区域
3. "生成视频"按钮  
4. 视频播放器

参考API文档：`backend/API使用说明.md`
