# Story Universe Platform - 前端完整功能测试文档

## 📋 测试环境准备

### 1. 启动后端服务
```bash
cd backend
python -m uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### 2. 验证后端运行
```bash
curl http://localhost:8000/health
# 预期返回: {"status":"healthy"}
```

### 3. 启动前端服务
```bash
cd frontend
npm run dev
# 访问: http://localhost:3000
```

### 4. 打开浏览器开发者工具
- 按 F12 打开开发者工具
- 切换到 Console 标签查看日志
- 切换到 Network 标签查看网络请求

---

## 🎯 功能测试清单

## 一、小说创作模块 (/novel)

### 1.1 大纲生成功能

#### 测试步骤
1. 访问 http://localhost:3000/novel
2. 选择"大纲生成"标签
3. 填写表单：
   - **题材**: 科幻
   - **风格**: 现代主义
   - **关键词**: 输入"AI"，按回车添加；输入"未来"，按回车添加
   - **目标长度**: 中篇
4. 点击"生成故事大纲"按钮
5. 等待生成（预计40-60秒）

#### 预期结果
- ✅ 按钮显示加载状态："正在生成大纲..."
- ✅ 不出现超时错误（已修复为120秒超时）
- ✅ 成功返回大纲内容
- ✅ 大纲包含以下部分：
  - 故事梗概
  - 主要人物设定
  - 世界观设定
  - 故事结构
  - 章节大纲
  - 主要冲突和转折点
  - 主题思想和象征元素

#### 测试用例
| 用例 | 题材 | 风格 | 关键词 | 目标长度 | 预期结果 |
|------|------|------|--------|----------|----------|
| 用例1 | 科幻 | 现代主义 | AI, 未来 | 中篇 | 成功生成 |
| 用例2 | 言情 | 诗意化 | 爱情, 青春 | 短篇 | 成功生成 |
| 用例3 | 悬疑 | 极简主义 | 推理, 真相 | 长篇 | 成功生成 |

#### 功能测试
- [ ] 必填项验证（不填写时提示错误）
- [ ] 关键词添加和删除
- [ ] 加载状态显示
- [ ] 大纲内容正确显示
- [ ] 背景资料显示（如果有）

---

### 1.2 章节续写功能

#### 测试步骤
1. 访问 http://localhost:3000/novel
2. 选择"章节续写"标签
3. 在"前文内容"输入框输入：
   ```
   在2050年的上海，人工智能已经渗透到生活的每一个角落。李明是一名AI伦理学家，他每天的工作就是审查各种AI系统的决策是否符合人类价值观。
   ```
4. 设置续写方向（可选）：主角遇到一个棘手的AI伦理问题
5. 调整目标字数：1000字
6. 点击"开始续写"按钮

#### 预期结果
- ✅ 成功生成续写内容
- ✅ 续写内容与前文风格一致
- ✅ 字数接近目标字数
- ✅ 显示完整章节预览（前文+续写）
- ✅ 复制和下载功能正常

#### 测试用例
| 用例 | 前文长度 | 续写方向 | 目标字数 | 预期结果 |
|------|----------|----------|----------|----------|
| 用例1 | 100字 | 无 | 500字 | 成功续写 |
| 用例2 | 500字 | 情节转折 | 1000字 | 成功续写 |
| 用例3 | 1000字 | 引入新角色 | 1500字 | 成功续写 |

#### 功能测试
- [ ] 前文内容输入
- [ ] 续写方向设置（可选）
- [ ] 目标字数滑块调整
- [ ] 续写内容生成
- [ ] 完整章节预览
- [ ] 复制续写部分
- [ ] 复制全文
- [ ] 下载功能
- [ ] 字数统计显示

---

### 1.3 风格调整功能

#### 测试步骤
1. 访问 http://localhost:3000/novel
2. 选择"风格调整"标签
3. 在"原始内容"输入：
   ```
   他走进房间，看到桌上有一封信。他打开信，读了起来。信的内容让他很震惊。
   ```
4. 选择目标风格：诗意化
5. 输入风格描述（可选）：增加意象和情感描写
6. 点击"调整风格"按钮

#### 预期结果
- ✅ 成功生成调整后的内容
- ✅ 内容保持原意
- ✅ 风格符合选择的目标风格
- ✅ 显示对比预览
- ✅ 显示变化统计

#### 测试用例
| 用例 | 原始风格 | 目标风格 | 预期效果 |
|------|----------|----------|----------|
| 用例1 | 平实 | 诗意化 | 增加意象和修辞 |
| 用例2 | 冗长 | 极简主义 | 精简表达 |
| 用例3 | 现代 | 古典主义 | 文言化表达 |

#### 功能测试
- [ ] 原始内容输入
- [ ] 目标风格选择
- [ ] 风格描述输入（可选）
- [ ] 调整后内容生成
- [ ] 对比预览显示
- [ ] 变化统计（字数变化）
- [ ] 复制功能
- [ ] 下载功能
- [ ] 重置功能

---

## 二、角色生成模块 (/character)

### 2.1 角色信息生成

#### 测试步骤
1. 访问 http://localhost:3000/character
2. 填写表单：
   - **角色姓名**: Alex（可选）
   - **角色类型**: 主角
   - **年龄段**: 青年
   - **性别**: 男性
   - **故事背景**: 2050年的未来都市
   - **性格特征**: 勇敢、理性、富有正义感
   - **额外描述**: 是一名AI伦理学家
3. 点击"生成角色"按钮

#### 预期结果
- ✅ 成功生成角色信息
- ✅ 包含以下部分：
  - 基本信息（姓名、年龄、性别、职业、国籍）
  - 外貌特征（身高、体型、发色、眼睛颜色、服装风格、特殊特征）
  - 性格特点（主要特征、优点、缺点、习惯、恐惧）
  - 背景故事（童年、教育、家庭、重要经历）
  - 技能能力（专业技能、特殊才能、战斗能力、掌握语言）
  - 人际关系（家庭关系、友谊、恋爱对象、对手敌人）
  - 目标动机（短期目标、长期目标、内在动机、恐惧担忧）
  - 对话风格（说话方式、词汇特点、标志性台词、沟通风格）

#### 测试用例
| 用例 | 角色类型 | 故事背景 | 预期结果 |
|------|----------|----------|----------|
| 用例1 | 主角 | 未来都市 | 完整角色设定 |
| 用例2 | 反派 | 古代江湖 | 完整角色设定 |
| 用例3 | 配角 | 魔法世界 | 完整角色设定 |

#### 功能测试
- [ ] 必填项验证（角色类型、故事背景）
- [ ] 可选项填写
- [ ] 角色信息生成
- [ ] 结构化信息显示
- [ ] 复制功能
- [ ] 下载JSON功能
- [ ] 保存到画廊功能

---

### 2.2 角色立绘生成

#### 测试步骤
1. 先完成角色信息生成
2. 在"角色立绘"部分选择艺术风格：
   - 动漫风格
   - 写实风格
   - 古风风格
   - 奇幻风格
   - 科幻风格
   - 游戏风格
3. 点击对应风格按钮

#### 预期结果
- ✅ 显示加载状态
- ✅ 成功生成角色立绘图片
- ✅ 图片符合选择的艺术风格
- ✅ 图片可以放大查看

#### 测试用例
| 用例 | 艺术风格 | 预期效果 |
|------|----------|----------|
| 用例1 | 动漫风格 | 日系动漫画风 |
| 用例2 | 写实风格 | 真实照片质感 |
| 用例3 | 古风风格 | 中国古典画风 |

#### 功能测试
- [ ] 需要先生成角色信息
- [ ] 各种风格按钮可点击
- [ ] 加载状态显示
- [ ] 图片生成成功
- [ ] 图片正确显示
- [ ] 图片可放大查看

---

## 三、剧本转换模块 (/script)

### 3.1 小说转剧本

#### 测试步骤
1. 访问 http://localhost:3000/script
2. 在"输入内容"区域输入小说文本：
   ```
   李明走进实验室，看到桌上的全息投影正在播放一段视频。视频中，一个AI机器人正在做出一个违背人类伦理的决定。
   
   "这不可能！"李明惊呼道。
   
   他的助手小王走了过来，"李博士，这是昨天记录的。我们需要立即采取行动。"
   ```
3. 点击"转换"按钮

#### 预期结果
- ✅ 成功转换为剧本格式
- ✅ 包含场景描述
- ✅ 包含人物对话
- ✅ 包含动作描述
- ✅ 格式规范

#### 测试用例
| 用例 | 输入类型 | 预期结果 |
|------|----------|----------|
| 用例1 | 对话为主 | 标准剧本格式 |
| 用例2 | 描写为主 | 场景描述+动作 |
| 用例3 | 混合内容 | 完整剧本格式 |

#### 功能测试
- [ ] 输入内容验证
- [ ] 转换功能
- [ ] 结果显示
- [ ] 复制功能

---

## 四、分镜助手模块 (/storyboard)

### 4.1 文本转分镜

#### 测试步骤
1. 访问 http://localhost:3000/storyboard
2. 选择"文本转分镜"标签
3. 输入剧本内容：
   ```
   场景：实验室 - 白天
   
   李明走进实验室，看到全息投影。
   
   李明：这不可能！
   
   小王走过来。
   
   小王：李博士，我们需要立即采取行动。
   ```
4. 选择分镜风格：电影感
5. 设置镜头数量：6
6. 点击"生成分镜"按钮

#### 预期结果
- ✅ 成功生成分镜脚本
- ✅ 包含镜头编号
- ✅ 包含镜头类型（特写、中景、全景等）
- ✅ 包含镜头描述
- ✅ 包含运镜方式

#### 测试用例
| 用例 | 风格 | 镜头数 | 预期结果 |
|------|------|--------|----------|
| 用例1 | 电影感 | 6 | 专业分镜脚本 |
| 用例2 | 动画风格 | 8 | 动画分镜脚本 |
| 用例3 | 纪录片 | 4 | 纪实分镜脚本 |

#### 功能测试
- [ ] 剧本内容输入
- [ ] 风格选择
- [ ] 镜头数量设置
- [ ] 分镜生成
- [ ] 结果显示
- [ ] 复制和下载功能

---

### 4.2 参考图分析

#### 测试步骤
1. 访问 http://localhost:3000/storyboard
2. 选择"参考图分析"标签
3. 输入图片URL（测试图片链接）
4. 选择分析类型：构图分析
5. 点击"分析参考图"按钮

#### 预期结果
- ✅ 成功分析图片
- ✅ 返回构图分析结果
- ✅ 包含镜头建议

#### 功能测试
- [ ] 图片URL输入
- [ ] 分析类型选择
- [ ] 分析功能
- [ ] 结果显示

---

### 4.3 视频分析

#### 测试步骤
1. 访问 http://localhost:3000/storyboard
2. 选择"视频分析"标签
3. 输入视频URL
4. 选择分析焦点：镜头语言
5. 点击"分析视频"按钮

#### 预期结果
- ✅ 成功分析视频
- ✅ 返回镜头语言分析
- ✅ 包含分镜建议

#### 功能测试
- [ ] 视频URL输入
- [ ] 分析焦点选择
- [ ] 分析功能
- [ ] 结果显示

---

## 五、素材搜索模块 (/search)

### 5.1 背景搜索

#### 测试步骤
1. 访问 http://localhost:3000/search
2. 选择"背景搜索"标签
3. 输入搜索关键词：未来城市建筑
4. 选择搜索类型：图片
5. 点击"搜索"按钮

#### 预期结果
- ✅ 成功返回搜索结果
- ✅ 显示相关图片或资料
- ✅ 包含标题和描述

#### 测试用例
| 用例 | 关键词 | 类型 | 预期结果 |
|------|--------|------|----------|
| 用例1 | 未来城市 | 图片 | 相关图片 |
| 用例2 | 古代建筑 | 文本 | 相关资料 |
| 用例3 | 科幻场景 | 视频 | 相关视频 |

#### 功能测试
- [ ] 关键词输入
- [ ] 搜索类型选择
- [ ] 搜索功能
- [ ] 结果显示
- [ ] 搜索历史记录

---

### 5.2 热点话题

#### 测试步骤
1. 访问 http://localhost:3000/search
2. 选择"热点话题"标签
3. 选择分类：科技
4. 点击"获取热点话题"按钮

#### 预期结果
- ✅ 成功返回热点话题列表
- ✅ 包含话题标题
- ✅ 包含话题描述
- ✅ 包含热度指标

#### 功能测试
- [ ] 分类选择
- [ ] 获取热点功能
- [ ] 话题列表显示
- [ ] 话题详情查看

---

### 5.3 灵感推荐

#### 测试步骤
1. 访问 http://localhost:3000/search
2. 选择"灵感推荐"标签
3. 填写表单：
   - **题材**: 科幻
   - **主题**: 人工智能
   - **风格**: 现代主义
   - **关键词**: AI, 伦理
4. 点击"获取创作灵感"按钮

#### 预期结果
- ✅ 成功返回灵感推荐
- ✅ 包含创作建议
- ✅ 包含参考资料
- ✅ 包含相关案例

#### 功能测试
- [ ] 表单填写
- [ ] 获取灵感功能
- [ ] 推荐内容显示
- [ ] 保存灵感功能

---

## 📊 测试报告模板

```
===========================================
Story Universe Platform - 前端功能测试报告
===========================================

测试日期: 2025-01-03
测试人员: [姓名]
浏览器: Chrome/Firefox/Safari [版本]
测试环境: 本地开发环境

-------------------------------------------
一、小说创作模块
-------------------------------------------
1.1 大纲生成
  状态: [✅ 通过 / ❌ 失败]
  响应时间: [X秒]
  问题: [如有问题请描述]

1.2 章节续写
  状态: [✅ 通过 / ❌ 失败]
  响应时间: [X秒]
  问题: [如有问题请描述]

1.3 风格调整
  状态: [✅ 通过 / ❌ 失败]
  响应时间: [X秒]
  问题: [如有问题请描述]

-------------------------------------------
二、角色生成模块
-------------------------------------------
2.1 角色信息生成
  状态: [✅ 通过 / ❌ 失败]
  响应时间: [X秒]
  问题: [如有问题请描述]

2.2 角色立绘生成
  状态: [✅ 通过 / ❌ 失败]
  响应时间: [X秒]
  问题: [如有问题请描述]

-------------------------------------------
三、剧本转换模块
-------------------------------------------
3.1 小说转剧本
  状态: [✅ 通过 / ❌ 失败]
  响应时间: [X秒]
  问题: [如有问题请描述]

-------------------------------------------
四、分镜助手模块
-------------------------------------------
4.1 文本转分镜
  状态: [✅ 通过 / ❌ 失败]
  响应时间: [X秒]
  问题: [如有问题请描述]

4.2 参考图分析
  状态: [✅ 通过 / ❌ 失败]
  响应时间: [X秒]
  问题: [如有问题请描述]

4.3 视频分析
  状态: [✅ 通过 / ❌ 失败]
  响应时间: [X秒]
  问题: [如有问题请描述]

-------------------------------------------
五、素材搜索模块
-------------------------------------------
5.1 背景搜索
  状态: [✅ 通过 / ❌ 失败]
  响应时间: [X秒]
  问题: [如有问题请描述]

5.2 热点话题
  状态: [✅ 通过 / ❌ 失败]
  响应时间: [X秒]
  问题: [如有问题请描述]

5.3 灵感推荐
  状态: [✅ 通过 / ❌ 失败]
  响应时间: [X秒]
  问题: [如有问题请描述]

-------------------------------------------
测试统计
-------------------------------------------
总功能数: 12
通过数: [X]
失败数: [X]
成功率: [X%]
平均响应时间: [X秒]

-------------------------------------------
问题汇总
-------------------------------------------
1. [问题描述]
   - 功能: [功能名称]
   - 错误信息: [错误详情]
   - 重现步骤: [步骤]

2. [问题描述]
   ...

-------------------------------------------
优化建议
-------------------------------------------
1. [建议内容]
2. [建议内容]

-------------------------------------------
总体评价
-------------------------------------------
[整体评价和结论]

测试人签名: ___________
日期: ___________
```

---

## 🔧 常见问题排查

### 问题1: 超时错误
**错误信息**: "timeout of 120000ms exceeded"
**解决方案**:
1. 检查后端是否正常运行
2. 查看后端日志是否有错误
3. 检查网络连接
4. 等待2-3分钟后重试

### 问题2: 连接失败
**错误信息**: "Failed to fetch" 或 "Network Error"
**解决方案**:
1. 确认后端运行在 http://localhost:8000
2. 检查 `frontend/lib/api.ts` 中的 API_BASE_URL
3. 检查防火墙设置
4. 查看CORS配置

### 问题3: 422错误
**错误信息**: "Unprocessable Entity"
**解决方案**:
1. 检查必填字段是否填写
2. 查看控制台的请求详情
3. 对比API文档的参数要求

### 问题4: 500错误
**错误信息**: "Internal Server Error"
**解决方案**:
1. 查看后端控制台的错误日志
2. 检查API密钥是否有效
3. 确认模型调用是否成功

### 问题5: 图片不显示
**解决方案**:
1. 检查图片URL是否有效
2. 查看网络请求是否成功
3. 检查CORS设置

---

## 📝 测试注意事项

1. **测试间隔**: 每个功能测试后等待15-30秒，避免API限流
2. **数据准备**: 准备好测试用的文本、图片URL、视频URL
3. **浏览器缓存**: 测试前清除浏览器缓存（Ctrl+Shift+Delete）
4. **开发者工具**: 始终打开开发者工具，记录错误信息
5. **截图记录**: 对失败的功能进行截图
6. **日志保存**: 保存控制台日志和网络请求详情

---

## 🚀 快速测试命令

### 启动服务
```bash
# 终端1: 启动后端
cd backend
python -m uvicorn main:app --reload --host 0.0.0.0 --port 8000

# 终端2: 启动前端
cd frontend
npm run dev
```

### 访问测试页面
- 首页: http://localhost:3000
- 小说创作: http://localhost:3000/novel
- 角色生成: http://localhost:3000/character
- 剧本转换: http://localhost:3000/script
- 分镜助手: http://localhost:3000/storyboard
- 素材搜索: http://localhost:3000/search

---

**测试完成后，请填写测试报告并提交！** ✅
